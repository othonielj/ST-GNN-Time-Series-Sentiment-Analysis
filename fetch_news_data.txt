import requests
import pandas as pd
from datetime import datetime, timedelta

# Set your API Key from https://newsapi.org/
API_KEY = '8948bb1176e843f2842f336f116de1be'

# List of stocks
stocks = ['NVDA', 'AMD', 'INTC', 'AVGO', 'TSM', 'QCOM', 'TXN', 'MU', 'ASML', 'MRVL']

# Define the date range
end_date = datetime.today().strftime('%Y-%m-%d')  # Today
start_date = (datetime.today() - timedelta(days=30)).strftime('%Y-%m-%d')  # 30 days ago

# Empty list to store results
news_data = []

# Fetch news for each stock
for stock in stocks:
    print(f"Fetching news for: {stock}")
    
    # Construct the URL with parameters
    url = (f"https://newsapi.org/v2/everything?"
           f"q={stock}&"
           f"from={start_date}&"
           f"to={end_date}&"
           f"sortBy=popularity&"
           f"language=en&"
           f"apiKey={API_KEY}")

    response = requests.get(url)

    if response.status_code == 200:
        articles = response.json().get("articles", [])
        for article in articles:
            news_data.append({
                "stock": stock,
                "title": article["title"],
                "description": article["description"],
                "source": article["source"]["name"],
                "published_at": article["publishedAt"],
                "url": article["url"]
            })
    else:
        print(f"Failed to fetch news for {stock}: {response.status_code}")

# Convert results to a Pandas DataFrame
df_news = pd.DataFrame(news_data)

# Save the data to a CSV file
df_news.to_csv("stock_news_data.csv", index=False)

print("News data saved successfully.")
